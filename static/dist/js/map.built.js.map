{"version":3,"sources":["../../js/map.js"],"names":["$selectExclude","$selectPokemonNotify","$selectRarityNotify","$textPerfectionNotify","$selectStyle","$selectIconResolution","$selectIconSize","$selectLuredPokestopsOnly","$selectSearchIconMarker","$selectGymMarkerStyle","$selectLocationIconMarker","language","document","documentElement","lang","idToPokemon","i8lnDictionary","languageLookups","languageLookupThreshold","searchMarkerStyles","timestamp","excludedPokemon","notifiedPokemon","notifiedRarity","notifiedMinPerfection","buffer","reincludedPokemon","reids","map","rawDataIsLoading","locationMarker","rangeMarkers","searchMarker","storeZoom","scanPath","moves","oSwLat","oSwLng","oNeLat","oNeLng","lastpokestops","lastgyms","lastpokemon","lastslocs","lastspawns","selectedStyle","updateWorker","lastUpdateTime","gymTypes","gymPrestige","audio","Audio","excludePokemon","id","val","concat","trigger","notifyAboutPokemon","removePokemonMarker","encounterId","mapData","pokemons","marker","rangeCircle","setMap","hidden","initMap","google","maps","Map","getElementById","center","lat","centerLat","lng","centerLng","zoom","Store","get","fullscreenControl","streetViewControl","mapTypeControl","clickableIcons","mapTypeControlOptions","style","MapTypeControlStyle","DROPDOWN_MENU","position","ControlPosition","RIGHT_TOP","mapTypeIds","MapTypeId","ROADMAP","SATELLITE","HYBRID","styleNoLabels","StyledMapType","noLabelsStyle","name","mapTypes","set","styleDark","darkStyle","styleLight2","light2Style","stylePgo","pGoStyle","styleDarkNl","darkStyleNoLabels","styleLight2Nl","light2StyleNoLabels","stylePgoNl","pGoStyleNoLabels","addListener","s","mapTypeId","setMapTypeId","updateMap","getZoom","redrawPokemon","lurePokemons","createSearchMarker","createLocationMarker","createMyLocationButton","initSidebar","$","on","loc","getCenter","changeLocation","checked","prop","searchControl","updateLocationMarker","setIcon","icon","Marker","animation","Animation","DROP","draggable","optimized","zIndex","MAX_ZINDEX","infoWindow","InfoWindow","content","disableAutoPan","addListeners","event","newLocation","getPosition","updateSearchMarker","oldLocation","changeSearchLocation","done","fail","setPosition","searchControlURI","action","post","encodeURIComponent","toggleClass","updateSearchStatus","getJSON","then","data","status","toggle","searchBox","places","SearchBox","css","setInterval","getPlaces","length","geometry","location","icons","each","pokemonSprites","key","value","append","attr","text","pad","number","slice","getTypeSpan","type","openMapDirections","myLocation","url","window","open","pokemonLabel","rarity","types","disappearTime","latitude","longitude","atk","def","sta","move1","move2","timedetail","disappearDate","Date","rarityDisplay","typesDisplay","index","details","iv","toFixed","i8ln","timecontent","getHours","getMinutes","getSeconds","contentstring","gymLabel","teamName","teamId","gymPoints","lastScanned","members","memberStr","i","pokemon_name","trainer_name","trainer_level","pokemon_id","pokemon_cp","lastScannedStr","lastScannedDate","getFullYear","getMonth","getDate","nameStr","gymColor","str","gymLevel","getGymLevel","points","level","pokestopLabel","expireTime","expireDate","formatSpawnTime","seconds","Math","floor","substr","spawnpointLabel","item","time","special","addRangeCircle","targetmap","circleCenter","LatLng","gymColors","teamColor","range","circleColor","rangeCircleOpts","radius","strokeWeight","strokeColor","strokeOpacity","fillColor","fillOpacity","Circle","isRangeActive","customizePokemonMarker","skipNotification","setAnimation","animationDisabled","indexOf","play","sendNotification","BOUNCE","perfection","setupGymMarker","scaledSize","Size","updateGymMarker","setContent","updateGymIcons","gyms","setupPokestopMarker","imagename","getColorByDate","diff","now","hue","toString","join","setupScannedMarker","clickable","getColorBySpawnTime","round","changeSpawnIcon","color","urlColor","zoomScale","minimumSize","newSize","newIcon","anchor","Point","spawnPointIndex","newIndex","scale","setupSpawnpointMarker","clearSelection","selection","empty","getSelection","removeAllRanges","infoWindowIsOpen","updateLabelDiffTime","persist","close","clearStaleMarkers","getTime","scanned","showInBoundsMarkers","markers","show","getBounds","intersects","contains","team_id","getMap","oldAnimation","getAnimation","loadRawData","loadPokemon","loadGyms","loadPokestops","loadScanned","loadSpawnpoints","loadLuredOnly","Boolean","bounds","swPoint","getSouthWest","nePoint","getNorthEast","swLat","swLng","neLat","neLng","ajax","String","dataType","cache","beforeSend","complete","processPokemons","setupPokemonMarker","processPokestops","pokestops","item2","updatePokestops","removeStops","currentTime","push","processGyms","processScanned","scanId","last_modified","updateScanned","setOptions","processSpawnpoints","spawnpoints","updateSpawnPoints","setZIndex","result","hasClass","countMarkers","Array","filter","e","drawScanPath","scanPathPoints","idx","point","Polyline","path","geodesic","pokemonList","newMarker","element","disappearsAt","parseInt","getAttribute","difference","abs","hours","minutes","timestring","getPointDistance","pointA","pointB","spherical","computeDistanceBetween","title","Notification","permission","requestPermission","notification","body","sound","onclick","focus","centerMap","locationContainer","createElement","locationButton","backgroundColor","border","outline","width","height","borderRadius","boxShadow","cursor","marginRight","padding","appendChild","locationIcon","margin","backgroundImage","backgroundSize","backgroundPosition","backgroundRepeat","addEventListener","centerMapOnLocation","controls","RIGHT_BOTTOM","currentLocation","imgX","animationInterval","navigator","geolocation","getCurrentPosition","latlng","coords","setCenter","clearInterval","setZoom","word","isEmptyObject","async","success","error","jqXHR","console","log","updateGeoLocation","panTo","createUpdateWorker","isMobileDevice","Worker","updateBlob","Blob","updateBlobURL","URL","createObjectURL","onmessage","postMessage","ex","message","styleList","select2","placeholder","minimumResultsForSearch","Infinity","searchMarkerStyleList","selectSearchIconMarker","formatState","state","$state","numberOfPokemon","pokeList","_types","pokemonType","templateResult","Number","isNaN","isTouchDevice","buildSwitchChangeListener","storageKey","d","dType","change","bind","options","wrapper","hide","setDraggable","alert","accordion","active","collapsible","heightStyle","DataTable","paging","searching","info","errMode","order"],"mappings":"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","file":"map.built.js","sourcesContent":["﻿//\n// Global map.js variables\n//\n\nvar $selectExclude\nvar $selectPokemonNotify\nvar $selectRarityNotify\nvar $textPerfectionNotify\nvar $selectStyle\nvar $selectIconResolution\nvar $selectIconSize\nvar $selectLuredPokestopsOnly\nvar $selectSearchIconMarker\nvar $selectGymMarkerStyle\nvar $selectLocationIconMarker\n\nvar language = document.documentElement.lang === '' ? 'en' : document.documentElement.lang\nvar idToPokemon = {}\nvar i8lnDictionary = {}\nvar languageLookups = 0\nvar languageLookupThreshold = 3\n\nvar searchMarkerStyles\n\nvar timestamp\nvar excludedPokemon = []\nvar notifiedPokemon = []\nvar notifiedRarity = []\nvar notifiedMinPerfection = null\n\nvar buffer = []\nvar reincludedPokemon = []\nvar reids = []\n\nvar map\nvar rawDataIsLoading = false\nvar locationMarker\nvar rangeMarkers = ['pokemon', 'pokestop', 'gym']\nvar searchMarker\nvar storeZoom = true\nvar scanPath\nvar moves\n\nvar oSwLat\nvar oSwLng\nvar oNeLat\nvar oNeLng\n\nvar lastpokestops\nvar lastgyms\nvar lastpokemon\nvar lastslocs\nvar lastspawns\n\nvar selectedStyle = 'light'\n\nvar updateWorker\nvar lastUpdateTime\n\nvar gymTypes = ['Uncontested', 'Mystic', 'Valor', 'Instinct']\nvar gymPrestige = [2000, 4000, 8000, 12000, 16000, 20000, 30000, 40000, 50000]\nvar audio = new Audio('static/sounds/ding.mp3')\n\n//\n// Functions\n//\n\nfunction excludePokemon (id) { // eslint-disable-line no-unused-vars\n  $selectExclude.val(\n    $selectExclude.val().concat(id)\n  ).trigger('change')\n}\n\nfunction notifyAboutPokemon (id) { // eslint-disable-line no-unused-vars\n  $selectPokemonNotify.val(\n    $selectPokemonNotify.val().concat(id)\n  ).trigger('change')\n}\n\nfunction removePokemonMarker (encounterId) { // eslint-disable-line no-unused-vars\n  if (mapData.pokemons[encounterId].marker.rangeCircle) {\n    mapData.pokemons[encounterId].marker.rangeCircle.setMap(null)\n    delete mapData.pokemons[encounterId].marker.rangeCircle\n  }\n  mapData.pokemons[encounterId].marker.setMap(null)\n  mapData.pokemons[encounterId].hidden = true\n}\n\nfunction initMap () { // eslint-disable-line no-unused-vars\n  map = new google.maps.Map(document.getElementById('map'), {\n    center: {\n      lat: centerLat,\n      lng: centerLng\n    },\n    zoom: Store.get('zoomLevel'),\n    fullscreenControl: true,\n    streetViewControl: false,\n    mapTypeControl: false,\n    clickableIcons: false,\n    mapTypeControlOptions: {\n      style: google.maps.MapTypeControlStyle.DROPDOWN_MENU,\n      position: google.maps.ControlPosition.RIGHT_TOP,\n      mapTypeIds: [\n        google.maps.MapTypeId.ROADMAP,\n        google.maps.MapTypeId.SATELLITE,\n        google.maps.MapTypeId.HYBRID,\n        'nolabels_style',\n        'dark_style',\n        'style_light2',\n        'style_pgo',\n        'dark_style_nl',\n        'style_light2_nl',\n        'style_pgo_nl'\n      ]\n    }\n  })\n\n  var styleNoLabels = new google.maps.StyledMapType(noLabelsStyle, {\n    name: 'No Labels'\n  })\n  map.mapTypes.set('nolabels_style', styleNoLabels)\n\n  var styleDark = new google.maps.StyledMapType(darkStyle, {\n    name: 'Dark'\n  })\n  map.mapTypes.set('dark_style', styleDark)\n\n  var styleLight2 = new google.maps.StyledMapType(light2Style, {\n    name: 'Light2'\n  })\n  map.mapTypes.set('style_light2', styleLight2)\n\n  var stylePgo = new google.maps.StyledMapType(pGoStyle, {\n    name: 'PokemonGo'\n  })\n  map.mapTypes.set('style_pgo', stylePgo)\n\n  var styleDarkNl = new google.maps.StyledMapType(darkStyleNoLabels, {\n    name: 'Dark (No Labels)'\n  })\n  map.mapTypes.set('dark_style_nl', styleDarkNl)\n\n  var styleLight2Nl = new google.maps.StyledMapType(light2StyleNoLabels, {\n    name: 'Light2 (No Labels)'\n  })\n  map.mapTypes.set('style_light2_nl', styleLight2Nl)\n\n  var stylePgoNl = new google.maps.StyledMapType(pGoStyleNoLabels, {\n    name: 'PokemonGo (No Labels)'\n  })\n  map.mapTypes.set('style_pgo_nl', stylePgoNl)\n\n  map.addListener('maptypeid_changed', function (s) {\n    Store.set('map_style', this.mapTypeId)\n  })\n\n  map.setMapTypeId(Store.get('map_style'))\n  map.addListener('idle', updateMap)\n\n  map.addListener('zoom_changed', function () {\n    if (storeZoom === true) {\n      Store.set('zoomLevel', this.getZoom())\n    } else {\n      storeZoom = true\n    }\n\n    redrawPokemon(mapData.pokemons)\n    redrawPokemon(mapData.lurePokemons)\n  })\n\n  searchMarker = createSearchMarker()\n  locationMarker = createLocationMarker()\n  createMyLocationButton()\n  initSidebar()\n\n  $('#scan-here').on('click', function () {\n    var loc = map.getCenter()\n    changeLocation(loc.lat(), loc.lng())\n\n    if (!$('#search-switch').checked) {\n      $('#search-switch').prop('checked', true)\n      searchControl('on')\n    }\n  })\n}\n\nfunction updateLocationMarker (style) {\n  if (style in searchMarkerStyles) {\n    locationMarker.setIcon(searchMarkerStyles[style].icon)\n    Store.set('locationMarkerStyle', style)\n  }\n  return locationMarker\n}\n\nfunction createLocationMarker () {\n  var position = Store.get('followMyLocationPosition')\n  var lat = ('lat' in position) ? position.lat : centerLat\n  var lng = ('lng' in position) ? position.lng : centerLng\n\n  var locationMarker = new google.maps.Marker({\n    map: map,\n    animation: google.maps.Animation.DROP,\n    position: {\n      lat: lat,\n      lng: lng\n    },\n    draggable: true,\n    icon: null,\n    optimized: false,\n    zIndex: google.maps.Marker.MAX_ZINDEX + 2\n  })\n\n  locationMarker.infoWindow = new google.maps.InfoWindow({\n    content: '<div><b>My Location</b></div>',\n    disableAutoPan: true\n  })\n\n  addListeners(locationMarker)\n\n  google.maps.event.addListener(locationMarker, 'dragend', function () {\n    var newLocation = locationMarker.getPosition()\n    Store.set('followMyLocationPosition', { lat: newLocation.lat(), lng: newLocation.lng() })\n  })\n\n  return locationMarker\n}\n\nfunction updateSearchMarker (style) {\n  if (style in searchMarkerStyles) {\n    searchMarker.setIcon(searchMarkerStyles[style].icon)\n    Store.set('searchMarkerStyle', style)\n  }\n\n  return searchMarker\n}\n\nfunction createSearchMarker () {\n  var searchMarker = new google.maps.Marker({ // need to keep reference.\n    position: {\n      lat: centerLat,\n      lng: centerLng\n    },\n    map: map,\n    animation: google.maps.Animation.DROP,\n    draggable: !Store.get('lockMarker'),\n    icon: null,\n    optimized: false,\n    zIndex: google.maps.Marker.MAX_ZINDEX + 1\n  })\n\n  searchMarker.infoWindow = new google.maps.InfoWindow({\n    content: '<div><b>Search Location</b></div>',\n    disableAutoPan: true\n  })\n\n  addListeners(searchMarker)\n\n  var oldLocation = null\n  google.maps.event.addListener(searchMarker, 'dragstart', function () {\n    oldLocation = searchMarker.getPosition()\n  })\n\n  google.maps.event.addListener(searchMarker, 'dragend', function () {\n    var newLocation = searchMarker.getPosition()\n    changeSearchLocation(newLocation.lat(), newLocation.lng())\n      .done(function () {\n        oldLocation = null\n      })\n      .fail(function () {\n        if (oldLocation) {\n          searchMarker.setPosition(oldLocation)\n        }\n      })\n  })\n\n  return searchMarker\n}\n\nvar searchControlURI = 'search_control'\nfunction searchControl (action) {\n  $.post(searchControlURI + '?action=' + encodeURIComponent(action))\n  $('#scan-here').toggleClass('disabled', action === 'off')\n}\nfunction updateSearchStatus () {\n  $.getJSON(searchControlURI).then(function (data) {\n    $('#search-switch').prop('checked', data.status)\n    $('#scan-here').toggleClass('disabled', !data.status)\n  })\n}\n\nfunction initSidebar () {\n  $('#gyms-switch').prop('checked', Store.get('showGyms'))\n  $('#pokemon-switch').prop('checked', Store.get('showPokemon'))\n  $('#pokestops-switch').prop('checked', Store.get('showPokestops'))\n  $('#lured-pokestops-only-switch').val(Store.get('showLuredPokestopsOnly'))\n  $('#lured-pokestops-only-wrapper').toggle(Store.get('showPokestops'))\n  $('#geoloc-switch').prop('checked', Store.get('geoLocate'))\n  $('#lock-marker-switch').prop('checked', Store.get('lockMarker'))\n  $('#start-at-user-location-switch').prop('checked', Store.get('startAtUserLocation'))\n  $('#follow-my-location-switch').prop('checked', Store.get('followMyLocation'))\n  $('#scan-here-switch').prop('checked', Store.get('scanHere'))\n  $('#scan-here').toggle(Store.get('scanHere'))\n  $('#scanned-switch').prop('checked', Store.get('showScanned'))\n  $('#spawnpoints-switch').prop('checked', Store.get('showSpawnpoints'))\n  $('#ranges-switch').prop('checked', Store.get('showRanges'))\n  $('#sound-switch').prop('checked', Store.get('playSound'))\n  var searchBox = new google.maps.places.SearchBox(document.getElementById('next-location'))\n  $('#next-location').css('background-color', $('#geoloc-switch').prop('checked') ? '#e0e0e0' : '#ffffff')\n\n  updateSearchStatus()\n  setInterval(updateSearchStatus, 5000)\n\n  searchBox.addListener('places_changed', function () {\n    var places = searchBox.getPlaces()\n\n    if (places.length === 0) {\n      return\n    }\n\n    var loc = places[0].geometry.location\n    changeLocation(loc.lat(), loc.lng())\n  })\n\n  var icons = $('#pokemon-icons')\n  $.each(pokemonSprites, function (key, value) {\n    icons.append($('<option></option>').attr('value', key).text(value.name))\n  })\n  icons.val((pokemonSprites[Store.get('pokemonIcons')]) ? Store.get('pokemonIcons') : 'highres')\n  $('#pokemon-icon-size').val(Store.get('iconSizeModifier'))\n}\n\nfunction pad (number) {\n  return number <= 99 ? ('0' + number).slice(-2) : number\n}\n\nfunction getTypeSpan (type) {\n  return `<span style='padding: 2px 5px; text-transform: uppercase; color: white; margin-right: 2px; border-radius: 4px; font-size: 0.8em; vertical-align: text-bottom; background-color: ${type['color']}'>${type['type']}</span>`\n}\n\nfunction openMapDirections (lat, lng) { // eslint-disable-line no-unused-vars\n  var myLocation = locationMarker.getPosition()\n  var url = 'https://www.google.com/maps/dir/' + myLocation.lat() + ',' + myLocation.lng() + '/' + lat + ',' + lng\n  window.open(url, '_blank')\n}\n\nfunction pokemonLabel (name, rarity, types, disappearTime, id, latitude, longitude, encounterId, atk, def, sta, move1, move2, timedetail) {\n  var disappearDate = new Date(disappearTime)\n  var rarityDisplay = rarity ? '(' + rarity + ')' : ''\n  var typesDisplay = ''\n  $.each(types, function (index, type) {\n    typesDisplay += getTypeSpan(type)\n  })\n  var details = ''\n  if (atk != null) {\n    var iv = (atk + def + sta) / 45 * 100\n    details = `\n      <div>\n        IV: ${iv.toFixed(1)}% (${atk}/${def}/${sta})\n      </div>\n      <div>\n        Moves: ${i8ln(moves[move1]['name'])} / ${i8ln(moves[move2]['name'])}\n      </div>\n      `\n  }\n\n  var timecontent = ''\n\n  if (timedetail === 1) {\n    timecontent = `<div><span style=\"font-weight: bold; color: #3bb345\">This time is secure. It has been received from the server.</span><br>\n    Disappears at ${pad(disappearDate.getHours())}:${pad(disappearDate.getMinutes())}:${pad(disappearDate.getSeconds())}\n    <span class='label-countdown' disappears-at='${disappearTime}'>(00m00s)</span>\n    </div>`\n  } else if (timedetail === 0) {\n    timecontent = `<div><span style=\"font-weight: bold; color: #bfbc27\">This time is only a prediction. It may be wrong.</span><br>\n    Disappears at ${pad(disappearDate.getHours())}:${pad(disappearDate.getMinutes())}:${pad(disappearDate.getSeconds())}\n    <span class='label-countdown' disappears-at='${disappearTime}'>(00m00s)</span>\n    </div>`\n  } else if (timedetail === -1) {\n    timecontent = `<div><span style=\"font-weight: bold; color: #f1504e\">Don't trust this time! It has been set manually to<br>15m when this pokemon has been encountered</span><br>\n    Disappears at ${pad(disappearDate.getHours())}:${pad(disappearDate.getMinutes())}:${pad(disappearDate.getSeconds())}\n    <span class='label-countdown' disappears-at='${disappearTime}'>(00m00s)</span>\n    </div>`\n  }\n\n  var contentstring = `\n    <div>\n      <b>${name}</b>\n      <span> - </span>\n      <small>\n        <a href='http://www.pokemon.com/us/pokedex/${id}' target='_blank' title='View in Pokedex'>#${id}</a>\n      </small>\n      <span> ${rarityDisplay}</span>\n      <span> - </span>\n      <small>${typesDisplay}</small>\n    </div>` + timecontent + `\n    <div>\n      Location: ${latitude.toFixed(6)}, ${longitude.toFixed(7)}\n    </div>\n      ${details}\n    <div>\n      <a href='javascript:excludePokemon(${id})'>Exclude</a>&nbsp;&nbsp\n      <a href='javascript:notifyAboutPokemon(${id})'>Notify</a>&nbsp;&nbsp\n      <a href='javascript:removePokemonMarker(\"${encounterId}\")'>Remove</a>&nbsp;&nbsp\n      <a href='javascript:void(0);' onclick='javascript:openMapDirections(${latitude},${longitude});' title='View in Maps'>Get directions</a>\n    </div>`\n  return contentstring\n}\n\nfunction gymLabel (teamName, teamId, gymPoints, latitude, longitude, lastScanned = null, name = null, members = []) {\n  var memberStr = ''\n  for (var i = 0; i < members.length; i++) {\n    memberStr += `\n      <span class=\"gym-member\" title=\"${members[i].pokemon_name} | ${members[i].trainer_name} (Lvl ${members[i].trainer_level})\">\n        <i class=\"pokemon-sprite n${members[i].pokemon_id}\"></i>\n        <span class=\"cp team-${teamId}\">${members[i].pokemon_cp}</span>\n      </span>`\n  }\n\n  var lastScannedStr\n  if (lastScanned) {\n    var lastScannedDate = new Date(lastScanned)\n    lastScannedStr = `${lastScannedDate.getFullYear()}-${pad(lastScannedDate.getMonth() + 1)}-${pad(lastScannedDate.getDate())} ${pad(lastScannedDate.getHours())}:${pad(lastScannedDate.getMinutes())}:${pad(lastScannedDate.getSeconds())}`\n  } else {\n    lastScannedStr = 'Unknown'\n  }\n\n  var nameStr = (name ? `<div>${name}</div>` : '')\n\n  var gymColor = ['0, 0, 0, .4', '74, 138, 202, .6', '240, 68, 58, .6', '254, 217, 40, .6']\n  var str\n  if (teamId === 0) {\n    str = `\n      <div>\n        <center>\n          <div>\n            <b style='color:rgba(${gymColor[teamId]})'>${teamName}</b><br>\n            <img height='70px' style='padding: 5px;' src='static/forts/${teamName}_large.png'>\n          </div>\n          ${nameStr}\n          <div>\n            Location: ${latitude.toFixed(6)}, ${longitude.toFixed(7)}\n          </div>\n          <div>\n            Last Scanned: ${lastScannedStr}\n          </div>\n          <div>\n            <a href='javascript:void(0);' onclick='javascript:openMapDirections(${latitude},${longitude});' title='View in Maps'>Get directions</a>\n          </div>\n        </center>\n      </div>`\n  } else {\n    var gymLevel = getGymLevel(gymPoints)\n    str = `\n      <div>\n        <center>\n          <div style='padding-bottom: 2px'>\n            Gym owned by:\n          </div>\n          <div>\n            <b style='color:rgba(${gymColor[teamId]})'>Team ${teamName}</b><br>\n            <img height='70px' style='padding: 5px;' src='static/forts/${teamName}_large.png'>\n          </div>\n          <div>\n            ${nameStr}\n          </div>\n          <div>\n            Level: ${gymLevel} | Prestige: ${gymPoints}/${gymPrestige[gymLevel - 1] || 50000}\n          </div>\n          <div>\n            ${memberStr}\n          </div>\n          <div>\n            Location: ${latitude.toFixed(6)}, ${longitude.toFixed(7)}\n          </div>\n          <div>\n            Last Scanned: ${lastScannedStr}\n          </div>\n          <div>\n            <a href='javascript:void(0);' onclick='javascript:openMapDirections(${latitude},${longitude});' title='View in Maps'>Get directions</a>\n          </div>\n        </center>\n      </div>`\n  }\n\n  return str\n}\n\nfunction getGymLevel (points) {\n  var level = 1\n  while (points >= gymPrestige[level - 1]) {\n    level++\n  }\n\n  return level\n}\n\nfunction pokestopLabel (expireTime, latitude, longitude) {\n  var str\n  if (expireTime) {\n    var expireDate = new Date(expireTime)\n\n    str = `\n      <div>\n        <b>Lured Pokéstop</b>\n      </div>\n      <div>\n        Lure expires at ${pad(expireDate.getHours())}:${pad(expireDate.getMinutes())}:${pad(expireDate.getSeconds())}\n        <span class='label-countdown' disappears-at='${expireTime}'>(00m00s)</span>\n      </div>\n      <div>\n        Location: ${latitude.toFixed(6)}, ${longitude.toFixed(7)}\n      </div>\n      <div>\n        <a href='javascript:void(0);' onclick='javascript:openMapDirections(${latitude},${longitude});' title='View in Maps'>Get directions</a>\n      </div>`\n  } else {\n    str = `\n      <div>\n        <b>Pokéstop</b>\n      </div>\n      <div>\n        Location: ${latitude.toFixed(6)}, ${longitude.toFixed(7)}\n      </div>\n      <div>\n        <a href='javascript:void(0);' onclick='javascript:openMapDirections(${latitude},${longitude});' title='View in Maps'>Get directions</a>\n      </div>`\n  }\n\n  return str\n}\n\nfunction formatSpawnTime (seconds) {\n  // the addition and modulo are required here because the db stores when a spawn disappears\n  // the subtraction to get the appearance time will knock seconds under 0 if the spawn happens in the previous hour\n  return ('0' + Math.floor(((seconds + 3600) % 3600) / 60)).substr(-2) + ':' + ('0' + seconds % 60).substr(-2)\n}\nfunction spawnpointLabel (item) {\n  var str = `\n    <div>\n      <b>Spawn Point</b>\n    </div>\n    <div>\n      Every hour from ${formatSpawnTime(item.time)} to ${formatSpawnTime(item.time + 900)}\n    </div>`\n\n  if (item.special) {\n    str += `\n      <div>\n        May appear as early as ${formatSpawnTime(item.time - 1800)}\n      </div>`\n  }\n  return str\n}\n\nfunction addRangeCircle (marker, map, type, teamId) {\n  var targetmap = null\n  var circleCenter = new google.maps.LatLng(marker.position.lat(), marker.position.lng())\n  var gymColors = ['#999999', '#0051CF', '#FF260E', '#FECC23'] // 'Uncontested', 'Mystic', 'Valor', 'Instinct']\n  var teamColor = gymColors[0]\n  if (teamId) teamColor = gymColors[teamId]\n\n  var range\n  var circleColor\n\n  // handle each type of marker and be explicit about the range circle attributes\n  switch (type) {\n    case 'pokemon':\n      circleColor = '#C233F2'\n      range = 40 // pokemon appear at 40m and then you can move away. still have to be 40m close to see it though, so ignore the further disappear distance\n      break\n    case 'pokestop':\n      circleColor = '#3EB0FF'\n      range = 40\n      break\n    case 'gym':\n      circleColor = teamColor\n      range = 40\n      break\n  }\n\n  if (map) targetmap = map\n\n  var rangeCircleOpts = {\n    map: targetmap,\n    radius: range, // meters\n    strokeWeight: 1,\n    strokeColor: circleColor,\n    strokeOpacity: 0.9,\n    center: circleCenter,\n    fillColor: circleColor,\n    fillOpacity: 0.3\n  }\n  var rangeCircle = new google.maps.Circle(rangeCircleOpts)\n  return rangeCircle\n}\n\nfunction isRangeActive (map) {\n  if (map.getZoom() < 16) return false\n  return Store.get('showRanges')\n}\n\nfunction customizePokemonMarker (marker, item, skipNotification) {\n  marker.addListener('click', function () {\n    this.setAnimation(null)\n    this.animationDisabled = true\n  })\n\n  if (!marker.rangeCircle && isRangeActive(map)) {\n    marker.rangeCircle = addRangeCircle(marker, map, 'pokemon')\n  }\n\n  marker.infoWindow = new google.maps.InfoWindow({\n    content: pokemonLabel(item['pokemon_name'], item['pokemon_rarity'], item['pokemon_types'], item['disappear_time'], item['pokemon_id'], item['latitude'], item['longitude'], item['encounter_id'], item['individual_attack'], item['individual_defense'], item['individual_stamina'], item['move_1'], item['move_2'], item['time_detail']),\n    disableAutoPan: true\n  })\n\n  if (notifiedPokemon.indexOf(item['pokemon_id']) > -1 || notifiedRarity.indexOf(item['pokemon_rarity']) > -1) {\n    if (!skipNotification) {\n      if (Store.get('playSound')) {\n        audio.play()\n      }\n      sendNotification('A wild ' + item['pokemon_name'] + ' appeared!', 'Click to load map', 'static/icons/' + item['pokemon_id'] + '.png', item['latitude'], item['longitude'])\n    }\n    if (marker.animationDisabled !== true) {\n      marker.setAnimation(google.maps.Animation.BOUNCE)\n    }\n  }\n\n  if (item['individual_attack'] != null) {\n    var perfection = 100.0 * (item['individual_attack'] + item['individual_defense'] + item['individual_stamina']) / 45\n    if (notifiedMinPerfection > 0 && perfection >= notifiedMinPerfection) {\n      if (!skipNotification) {\n        if (Store.get('playSound')) {\n          audio.play()\n        }\n        sendNotification('A ' + perfection.toFixed(1) + '% perfect ' + item['pokemon_name'] + ' appeared!', 'Click to load map', 'static/icons/' + item['pokemon_id'] + '.png', item['latitude'], item['longitude'])\n      }\n      if (marker.animationDisabled !== true) {\n        marker.setAnimation(google.maps.Animation.BOUNCE)\n      }\n    }\n  }\n\n  addListeners(marker)\n}\n\nfunction setupGymMarker (item) {\n  var marker = new google.maps.Marker({\n    position: {\n      lat: item['latitude'],\n      lng: item['longitude']\n    },\n    map: map,\n    icon: {url: 'static/forts/' + Store.get('gymMarkerStyle') + '/' + gymTypes[item['team_id']] + (item['team_id'] !== 0 ? '_' + getGymLevel(item['gym_points']) : '') + '.png', scaledSize: new google.maps.Size(48, 48)}\n  })\n\n  if (!marker.rangeCircle && isRangeActive(map)) {\n    marker.rangeCircle = addRangeCircle(marker, map, 'gym', item['team_id'])\n  }\n\n  marker.infoWindow = new google.maps.InfoWindow({\n    content: gymLabel(gymTypes[item['team_id']], item['team_id'], item['gym_points'], item['latitude'], item['longitude'], item['last_scanned'], item['name'], item['pokemon']),\n    disableAutoPan: true\n  })\n\n  addListeners(marker)\n  return marker\n}\n\nfunction updateGymMarker (item, marker) {\n  marker.setIcon({url: 'static/forts/' + Store.get('gymMarkerStyle') + '/' + gymTypes[item['team_id']] + (item['team_id'] !== 0 ? '_' + getGymLevel(item['gym_points']) : '') + '.png', scaledSize: new google.maps.Size(48, 48)})\n  marker.infoWindow.setContent(gymLabel(gymTypes[item['team_id']], item['team_id'], item['gym_points'], item['latitude'], item['longitude'], item['last_scanned'], item['name'], item['pokemon']))\n  return marker\n}\nfunction updateGymIcons () {\n  $.each(mapData.gyms, function (key, value) {\n    mapData.gyms[key]['marker'].setIcon({url: 'static/forts/' + Store.get('gymMarkerStyle') + '/' + gymTypes[mapData.gyms[key]['team_id']] + (mapData.gyms[key]['team_id'] !== 0 ? '_' + getGymLevel(mapData.gyms[key]['gym_points']) : '') + '.png', scaledSize: new google.maps.Size(48, 48)})\n  })\n}\n\nfunction setupPokestopMarker (item) {\n  var imagename = item['lure_expiration'] ? 'PstopLured' : 'Pstop'\n  var marker = new google.maps.Marker({\n    position: {\n      lat: item['latitude'],\n      lng: item['longitude']\n    },\n    map: map,\n    zIndex: 2,\n    icon: 'static/forts/' + imagename + '.png'\n  })\n\n  if (!marker.rangeCircle && isRangeActive(map)) {\n    marker.rangeCircle = addRangeCircle(marker, map, 'pokestop')\n  }\n\n  marker.infoWindow = new google.maps.InfoWindow({\n    content: pokestopLabel(item['lure_expiration'], item['latitude'], item['longitude']),\n    disableAutoPan: true\n  })\n\n  addListeners(marker)\n  return marker\n}\n\nfunction getColorByDate (value) {\n  // Changes the color from red to green over 15 mins\n  var diff = (Date.now() - value) / 1000 / 60 / 15\n\n  if (diff > 1) {\n    diff = 1\n  }\n\n  // value from 0 to 1 - Green to Red\n  var hue = ((1 - diff) * 120).toString(10)\n  return ['hsl(', hue, ',100%,50%)'].join('')\n}\n\nfunction setupScannedMarker (item) {\n  var circleCenter = new google.maps.LatLng(item['latitude'], item['longitude'])\n\n  var marker = new google.maps.Circle({\n    map: map,\n    clickable: false,\n    center: circleCenter,\n    radius: 70, // metres\n    fillColor: getColorByDate(item['last_modified']),\n    fillOpacity: 0.1,\n    strokeWeight: 1,\n    strokeOpacity: 0.5\n  })\n\n  return marker\n}\n\nfunction getColorBySpawnTime (value) {\n  var now = new Date()\n  var seconds = now.getMinutes() * 60 + now.getSeconds()\n\n  // account for hour roll-over\n  if (seconds < 900 && value > 2700) {\n    seconds += 3600\n  } else if (seconds > 2700 && value < 900) {\n    value += 3600\n  }\n\n  var diff = (seconds - value)\n  var hue = 275 // light purple when spawn is neither about to spawn nor active\n  if (diff >= 0 && diff <= 900) { // green to red over 15 minutes of active spawn\n    hue = (1 - (diff / 60 / 15)) * 120\n  } else if (diff < 0 && diff > -300) { // light blue to dark blue over 5 minutes til spawn\n    hue = ((1 - (-diff / 60 / 5)) * 50) + 200\n  }\n\n  hue = Math.round(hue / 5) * 5\n\n  return hue\n}\n\nfunction changeSpawnIcon (color, zoom) {\n  var urlColor = ''\n  if (color === 275) {\n    urlColor = './static/icons/hsl-275-light.png'\n  } else {\n    urlColor = './static/icons/hsl-' + color + '.png'\n  }\n  var zoomScale = 1.6 // adjust this value to change the size of the spawnpoint icons\n  var minimumSize = 1\n  var newSize = Math.round(zoomScale * (zoom - 10)) // this scales the icon based on zoom\n  if (newSize < minimumSize) {\n    newSize = minimumSize\n  }\n\n  var newIcon = {\n    url: urlColor,\n    scaledSize: new google.maps.Size(newSize, newSize),\n    anchor: new google.maps.Point(newSize / 2, newSize / 2)\n  }\n\n  return newIcon\n}\n\nfunction spawnPointIndex (color) {\n  var newIndex = 1\n  var scale = 0\n  if (color >= 0 && color <= 120) { // high to low over 15 minutes of active spawn\n    scale = color / 120\n    newIndex = 100 + scale * 100\n  } else if (color >= 200 && color <= 250) { // low to high over 5 minutes til spawn\n    scale = (color - 200) / 50\n    newIndex = scale * 100\n  }\n\n  return newIndex\n}\n\nfunction setupSpawnpointMarker (item) {\n  var circleCenter = new google.maps.LatLng(item['latitude'], item['longitude'])\n  var hue = getColorBySpawnTime(item.time)\n  var zoom = map.getZoom()\n\n  var marker = new google.maps.Marker({\n    map: map,\n    position: circleCenter,\n    icon: changeSpawnIcon(hue, zoom),\n    zIndex: spawnPointIndex(hue)\n  })\n\n  marker.infoWindow = new google.maps.InfoWindow({\n    content: spawnpointLabel(item),\n    disableAutoPan: true,\n    position: circleCenter\n  })\n\n  addListeners(marker)\n\n  return marker\n}\n\nfunction clearSelection () {\n  if (document.selection) {\n    document.selection.empty()\n  } else if (window.getSelection) {\n    window.getSelection().removeAllRanges()\n  }\n}\n\nfunction addListeners (marker) {\n  marker.addListener('click', function () {\n    if (!marker.infoWindowIsOpen) {\n      marker.infoWindow.open(map, marker)\n      clearSelection()\n      updateLabelDiffTime()\n      marker.persist = true\n      marker.infoWindowIsOpen = true\n    } else {\n      marker.persist = null\n      marker.infoWindow.close()\n      marker.infoWindowIsOpen = false\n    }\n  })\n\n  google.maps.event.addListener(marker.infoWindow, 'closeclick', function () {\n    marker.persist = null\n  })\n\n  marker.addListener('mouseover', function () {\n    marker.infoWindow.open(map, marker)\n    clearSelection()\n    updateLabelDiffTime()\n  })\n\n  marker.addListener('mouseout', function () {\n    if (!marker.persist) {\n      marker.infoWindow.close()\n    }\n  })\n\n  return marker\n}\n\nfunction clearStaleMarkers () {\n  $.each(mapData.pokemons, function (key, value) {\n    if (mapData.pokemons[key]['disappear_time'] < new Date().getTime() ||\n      excludedPokemon.indexOf(mapData.pokemons[key]['pokemon_id']) >= 0) {\n      if (mapData.pokemons[key].marker.rangeCircle) {\n        mapData.pokemons[key].marker.rangeCircle.setMap(null)\n        delete mapData.pokemons[key].marker.rangeCircle\n      }\n      mapData.pokemons[key].marker.setMap(null)\n      delete mapData.pokemons[key]\n    }\n  })\n\n  $.each(mapData.lurePokemons, function (key, value) {\n    if (mapData.lurePokemons[key]['lure_expiration'] < new Date().getTime() ||\n      excludedPokemon.indexOf(mapData.lurePokemons[key]['pokemon_id']) >= 0) {\n      mapData.lurePokemons[key].marker.setMap(null)\n      delete mapData.lurePokemons[key]\n    }\n  })\n\n  $.each(mapData.scanned, function (key, value) {\n    // If older than 15mins remove\n    if (mapData.scanned[key]['last_modified'] < (new Date().getTime() - 15 * 60 * 1000)) {\n      mapData.scanned[key].marker.setMap(null)\n      delete mapData.scanned[key]\n    }\n  })\n}\n\nfunction showInBoundsMarkers (markers, type) {\n  $.each(markers, function (key, value) {\n    var marker = markers[key].marker\n    var show = false\n    if (!markers[key].hidden) {\n      if (typeof marker.getBounds === 'function') {\n        if (map.getBounds().intersects(marker.getBounds())) {\n          show = true\n        }\n      } else if (typeof marker.getPosition === 'function') {\n        if (map.getBounds().contains(marker.getPosition())) {\n          show = true\n        }\n      }\n    }\n    // marker has an associated range\n    if (show && rangeMarkers.indexOf(type) !== -1) {\n      // no range circle yet...let's create one\n      if (!marker.rangeCircle) {\n        // but only if range is active\n        if (isRangeActive(map)) {\n          if (type === 'gym') marker.rangeCircle = addRangeCircle(marker, map, type, markers[key].team_id)\n          else marker.rangeCircle = addRangeCircle(marker, map, type)\n        }\n      } else { // there's already a range circle\n        if (isRangeActive(map)) {\n          marker.rangeCircle.setMap(map)\n        } else {\n          marker.rangeCircle.setMap(null)\n        }\n      }\n    }\n\n    if (show && !marker.getMap()) {\n      marker.setMap(map)\n      // Not all markers can be animated (ex: scan locations)\n      if (marker.setAnimation && marker.oldAnimation) {\n        marker.setAnimation(marker.oldAnimation)\n      }\n    } else if (!show && marker.getMap()) {\n      // Not all markers can be animated (ex: scan locations)\n      if (marker.getAnimation) {\n        marker.oldAnimation = marker.getAnimation()\n      }\n      if (marker.rangeCircle) marker.rangeCircle.setMap(null)\n      marker.setMap(null)\n    }\n  })\n}\n\nfunction loadRawData () {\n  var loadPokemon = Store.get('showPokemon')\n  var loadGyms = Store.get('showGyms')\n  var loadPokestops = Store.get('showPokestops')\n  var loadScanned = Store.get('showScanned')\n  var loadSpawnpoints = Store.get('showSpawnpoints')\n  var loadLuredOnly = Boolean(Store.get('showLuredPokestopsOnly'))\n\n  var bounds = map.getBounds()\n  var swPoint = bounds.getSouthWest()\n  var nePoint = bounds.getNorthEast()\n  var swLat = swPoint.lat()\n  var swLng = swPoint.lng()\n  var neLat = nePoint.lat()\n  var neLng = nePoint.lng()\n\n  return $.ajax({\n    url: 'raw_data',\n    type: 'GET',\n    data: {\n      'timestamp': timestamp,\n      'pokemon': loadPokemon,\n      'lastpokemon': lastpokemon,\n      'pokestops': loadPokestops,\n      'lastpokestops': lastpokestops,\n      'luredonly': loadLuredOnly,\n      'gyms': loadGyms,\n      'lastgyms': lastgyms,\n      'scanned': loadScanned,\n      'lastslocs': lastslocs,\n      'spawnpoints': loadSpawnpoints,\n      'lastspawns': lastspawns,\n      'swLat': swLat,\n      'swLng': swLng,\n      'neLat': neLat,\n      'neLng': neLng,\n      'oSwLat': oSwLat,\n      'oSwLng': oSwLng,\n      'oNeLat': oNeLat,\n      'oNeLng': oNeLng,\n      'reids': String(reincludedPokemon),\n      'eids': String(excludedPokemon)\n    },\n    dataType: 'json',\n    cache: false,\n    beforeSend: function () {\n      if (rawDataIsLoading) {\n        return false\n      } else {\n        rawDataIsLoading = true\n      }\n    },\n    complete: function () {\n      rawDataIsLoading = false\n    }\n  })\n}\n\nfunction processPokemons (i, item) {\n  if (!Store.get('showPokemon')) {\n    return false // in case the checkbox was unchecked in the meantime.\n  }\n\n  if (!(item['encounter_id'] in mapData.pokemons) &&\n    excludedPokemon.indexOf(item['pokemon_id']) < 0 && item['disappear_time'] > Date.now()) {\n    // add marker to map and item to dict\n    if (item.marker) {\n      item.marker.setMap(null)\n    }\n    if (!item.hidden) {\n      item.marker = setupPokemonMarker(item, map)\n      customizePokemonMarker(item.marker, item)\n      mapData.pokemons[item['encounter_id']] = item\n    }\n  }\n}\n\nfunction processPokestops (i, item) {\n  if (!Store.get('showPokestops')) {\n    return false\n  }\n\n  if (Store.get('showLuredPokestopsOnly') && !item['lure_expiration']) {\n    return true\n  }\n\n  if (!mapData.pokestops[item['pokestop_id']]) { // new pokestop, add marker to map and item to dict\n    if (item.marker && item.marker.rangeCircle) {\n      item.marker.rangeCircle.setMap(null)\n    }\n    if (item.marker) {\n      item.marker.setMap(null)\n    }\n    item.marker = setupPokestopMarker(item)\n    mapData.pokestops[item['pokestop_id']] = item\n  } else {  // change existing pokestop marker to unlured/lured\n    var item2 = mapData.pokestops[item['pokestop_id']]\n    if (!!item['lure_expiration'] !== !!item2['lure_expiration']) {\n      if (item2.marker && item2.marker.rangeCircle) {\n        item2.marker.rangeCircle.setMap(null)\n      }\n      item2.marker.setMap(null)\n      item.marker = setupPokestopMarker(item)\n      mapData.pokestops[item['pokestop_id']] = item\n    }\n  }\n}\n\nfunction updatePokestops () {\n  if (!Store.get('showPokestops')) {\n    return false\n  }\n\n  var removeStops = []\n  var currentTime = new Date().getTime()\n\n  // change lured pokestop marker to unlured when expired\n  $.each(mapData.pokestops, function (key, value) {\n    if (value['lure_expiration'] && value['lure_expiration'] < currentTime) {\n      value['lure_expiration'] = null\n      if (value.marker && value.marker.rangeCircle) {\n        value.marker.rangeCircle.setMap(null)\n      }\n      value.marker.setMap(null)\n      value.marker = setupPokestopMarker(value)\n    }\n  })\n\n  // remove unlured stops if show lured only is selected\n  if (Store.get('showLuredPokestopsOnly')) {\n    $.each(mapData.pokestops, function (key, value) {\n      if (!value['lure_expiration']) {\n        removeStops.push(key)\n      }\n    })\n    $.each(removeStops, function (key, value) {\n      if (mapData.pokestops[value] && mapData.pokestops[value].marker) {\n        if (mapData.pokestops[value].marker.rangeCircle) {\n          mapData.pokestops[value].marker.rangeCircle.setMap(null)\n        }\n        mapData.pokestops[value].marker.setMap(null)\n        delete mapData.pokestops[value]\n      }\n    })\n  }\n}\n\nfunction processGyms (i, item) {\n  if (!Store.get('showGyms')) {\n    return false // in case the checkbox was unchecked in the meantime.\n  }\n\n  if (item['gym_id'] in mapData.gyms) {\n    item.marker = updateGymMarker(item, mapData.gyms[item['gym_id']].marker)\n  } else { // add marker to map and item to dict\n    item.marker = setupGymMarker(item)\n  }\n  mapData.gyms[item['gym_id']] = item\n}\n\nfunction processScanned (i, item) {\n  if (!Store.get('showScanned')) {\n    return false\n  }\n\n  var scanId = item['latitude'] + '|' + item['longitude']\n\n  if (!(scanId in mapData.scanned)) { // add marker to map and item to dict\n    if (item.marker) {\n      item.marker.setMap(null)\n    }\n    item.marker = setupScannedMarker(item)\n    mapData.scanned[scanId] = item\n  } else {\n    mapData.scanned[scanId].last_modified = item['last_modified']\n  }\n}\n\nfunction updateScanned () {\n  if (!Store.get('showScanned')) {\n    return false\n  }\n\n  $.each(mapData.scanned, function (key, value) {\n    if (map.getBounds().intersects(value.marker.getBounds())) {\n      value.marker.setOptions({\n        fillColor: getColorByDate(value['last_modified'])\n      })\n    }\n  })\n}\n\nfunction processSpawnpoints (i, item) {\n  if (!Store.get('showSpawnpoints')) {\n    return false\n  }\n\n  var id = item['spawnpoint_id']\n\n  if (!(id in mapData.spawnpoints)) { // add marker to map and item to dict\n    if (item.marker) {\n      item.marker.setMap(null)\n    }\n    item.marker = setupSpawnpointMarker(item)\n    mapData.spawnpoints[id] = item\n  }\n}\n\nfunction updateSpawnPoints () {\n  if (!Store.get('showSpawnpoints')) {\n    return false\n  }\n\n  var zoom = map.getZoom()\n\n  $.each(mapData.spawnpoints, function (key, value) {\n    if (map.getBounds().contains(value.marker.getPosition())) {\n      var hue = getColorBySpawnTime(value['time'])\n      value.marker.setIcon(changeSpawnIcon(hue, zoom))\n      value.marker.setZIndex(spawnPointIndex(hue))\n    }\n  })\n}\n\nfunction updateMap () {\n  loadRawData().done(function (result) {\n    $.each(result.pokemons, processPokemons)\n    $.each(result.pokestops, processPokestops)\n    $.each(result.gyms, processGyms)\n    $.each(result.scanned, processScanned)\n    $.each(result.spawnpoints, processSpawnpoints)\n    showInBoundsMarkers(mapData.pokemons, 'pokemon')\n    showInBoundsMarkers(mapData.lurePokemons, 'pokemon')\n    showInBoundsMarkers(mapData.gyms, 'gym')\n    showInBoundsMarkers(mapData.pokestops, 'pokestop')\n    showInBoundsMarkers(mapData.scanned, 'scanned')\n    showInBoundsMarkers(mapData.spawnpoints, 'inbound')\n//    drawScanPath(result.scanned);\n    clearStaleMarkers()\n\n    updateScanned()\n    updateSpawnPoints()\n    updatePokestops()\n\n    if ($('#stats').hasClass('visible')) {\n      countMarkers(map)\n    }\n\n    oSwLat = result.oSwLat\n    oSwLng = result.oSwLng\n    oNeLat = result.oNeLat\n    oNeLng = result.oNeLng\n\n    lastgyms = result.lastgyms\n    lastpokestops = result.lastpokestops\n    lastpokemon = result.lastpokemon\n    lastslocs = result.lastslocs\n    lastspawns = result.lastspawns\n\n    reids = result.reids\n    if (reids instanceof Array) {\n      reincludedPokemon = reids.filter(function (e) { return this.indexOf(e) < 0 }, reincludedPokemon)\n    }\n    timestamp = result.timestamp\n    lastUpdateTime = Date.now()\n  })\n}\n\nfunction drawScanPath (points) { // eslint-disable-line no-unused-vars\n  var scanPathPoints = []\n  $.each(points, function (idx, point) {\n    scanPathPoints.push({lat: point['latitude'], lng: point['longitude']})\n  })\n  if (scanPath) {\n    scanPath.setMap(null)\n  }\n  scanPath = new google.maps.Polyline({\n    path: scanPathPoints,\n    geodesic: true,\n    strokeColor: '#FF0000',\n    strokeOpacity: 1.0,\n    strokeWeight: 2,\n    map: map\n  })\n}\n\nfunction redrawPokemon (pokemonList) {\n  var skipNotification = true\n  $.each(pokemonList, function (key, value) {\n    var item = pokemonList[key]\n    if (!item.hidden) {\n      if (item.marker.rangeCircle) item.marker.rangeCircle.setMap(null)\n      var newMarker = setupPokemonMarker(item, map, this.marker.animationDisabled)\n      customizePokemonMarker(newMarker, item, skipNotification)\n      item.marker.setMap(null)\n      pokemonList[key].marker = newMarker\n    }\n  })\n}\n\nvar updateLabelDiffTime = function () {\n  $('.label-countdown').each(function (index, element) {\n    var disappearsAt = new Date(parseInt(element.getAttribute('disappears-at')))\n    var now = new Date()\n\n    var difference = Math.abs(disappearsAt - now)\n    var hours = Math.floor(difference / 36e5)\n    var minutes = Math.floor((difference - (hours * 36e5)) / 6e4)\n    var seconds = Math.floor((difference - (hours * 36e5) - (minutes * 6e4)) / 1e3)\n    var timestring = ''\n\n    if (disappearsAt < now) {\n      timestring = '(expired)'\n    } else {\n      timestring = '('\n      if (hours > 0) {\n        timestring = hours + 'h'\n      }\n\n      timestring += ('0' + minutes).slice(-2) + 'm'\n      timestring += ('0' + seconds).slice(-2) + 's'\n      timestring += ')'\n    }\n\n    $(element).text(timestring)\n  })\n}\n\nfunction getPointDistance (pointA, pointB) {\n  return google.maps.geometry.spherical.computeDistanceBetween(pointA, pointB)\n}\n\nfunction sendNotification (title, text, icon, lat, lng) {\n  if (!('Notification' in window)) {\n    return false // Notifications are not present in browser\n  }\n\n  if (Notification.permission !== 'granted') {\n    Notification.requestPermission()\n  } else {\n    var notification = new Notification(title, {\n      icon: icon,\n      body: text,\n      sound: 'sounds/ding.mp3'\n    })\n\n    notification.onclick = function () {\n      window.focus()\n      notification.close()\n\n      centerMap(lat, lng, 20)\n    }\n  }\n}\n\nfunction createMyLocationButton () {\n  var locationContainer = document.createElement('div')\n\n  var locationButton = document.createElement('button')\n  locationButton.style.backgroundColor = '#fff'\n  locationButton.style.border = 'none'\n  locationButton.style.outline = 'none'\n  locationButton.style.width = '28px'\n  locationButton.style.height = '28px'\n  locationButton.style.borderRadius = '2px'\n  locationButton.style.boxShadow = '0 1px 4px rgba(0,0,0,0.3)'\n  locationButton.style.cursor = 'pointer'\n  locationButton.style.marginRight = '10px'\n  locationButton.style.padding = '0px'\n  locationButton.title = 'My Location'\n  locationContainer.appendChild(locationButton)\n\n  var locationIcon = document.createElement('div')\n  locationIcon.style.margin = '5px'\n  locationIcon.style.width = '18px'\n  locationIcon.style.height = '18px'\n  locationIcon.style.backgroundImage = 'url(static/mylocation-sprite-1x.png)'\n  locationIcon.style.backgroundSize = '180px 18px'\n  locationIcon.style.backgroundPosition = '0px 0px'\n  locationIcon.style.backgroundRepeat = 'no-repeat'\n  locationIcon.id = 'current-location'\n  locationButton.appendChild(locationIcon)\n\n  locationButton.addEventListener('click', function () {\n    centerMapOnLocation()\n  })\n\n  locationContainer.index = 1\n  map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(locationContainer)\n\n  google.maps.event.addListener(map, 'dragend', function () {\n    var currentLocation = document.getElementById('current-location')\n    currentLocation.style.backgroundPosition = '0px 0px'\n  })\n}\n\nfunction centerMapOnLocation () {\n  var currentLocation = document.getElementById('current-location')\n  var imgX = '0'\n  var animationInterval = setInterval(function () {\n    if (imgX === '-18') {\n      imgX = '0'\n    } else {\n      imgX = '-18'\n    }\n    currentLocation.style.backgroundPosition = imgX + 'px 0'\n  }, 500)\n  if (navigator.geolocation) {\n    navigator.geolocation.getCurrentPosition(function (position) {\n      var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude)\n      locationMarker.setPosition(latlng)\n      map.setCenter(latlng)\n      Store.set('followMyLocationPosition', { lat: position.coords.latitude, lng: position.coords.longitude })\n      clearInterval(animationInterval)\n      currentLocation.style.backgroundPosition = '-144px 0px'\n    })\n  } else {\n    clearInterval(animationInterval)\n    currentLocation.style.backgroundPosition = '0px 0px'\n  }\n}\n\nfunction changeLocation (lat, lng) {\n  var loc = new google.maps.LatLng(lat, lng)\n  changeSearchLocation(lat, lng).done(function () {\n    map.setCenter(loc)\n    searchMarker.setPosition(loc)\n  })\n}\n\nfunction changeSearchLocation (lat, lng) {\n  return $.post('next_loc?lat=' + lat + '&lon=' + lng, {})\n}\n\nfunction centerMap (lat, lng, zoom) {\n  var loc = new google.maps.LatLng(lat, lng)\n\n  map.setCenter(loc)\n\n  if (zoom) {\n    storeZoom = false\n    map.setZoom(zoom)\n  }\n}\n\nfunction i8ln (word) {\n  if ($.isEmptyObject(i8lnDictionary) && language !== 'en' && languageLookups < languageLookupThreshold) {\n    $.ajax({\n      url: 'static/dist/locales/' + language + '.min.json',\n      dataType: 'json',\n      async: false,\n      success: function (data) {\n        i8lnDictionary = data\n      },\n      error: function (jqXHR, status, error) {\n        console.log('Error loading i8ln dictionary: ' + error)\n        languageLookups++\n      }\n    })\n  }\n  if (word in i8lnDictionary) {\n    return i8lnDictionary[word]\n  } else {\n    // Word doesn't exist in dictionary return it as is\n    return word\n  }\n}\n\nfunction updateGeoLocation () {\n  if (navigator.geolocation && (Store.get('geoLocate') || Store.get('followMyLocation'))) {\n    navigator.geolocation.getCurrentPosition(function (position) {\n      var lat = position.coords.latitude\n      var lng = position.coords.longitude\n      var center = new google.maps.LatLng(lat, lng)\n\n      if (Store.get('geoLocate')) {\n        // the search function makes any small movements cause a loop. Need to increase resolution\n        if ((typeof searchMarker !== 'undefined') && (getPointDistance(searchMarker.getPosition(), center) > 40)) {\n          $.post('next_loc?lat=' + lat + '&lon=' + lng).done(function () {\n            map.panTo(center)\n            searchMarker.setPosition(center)\n          })\n        }\n      }\n      if (Store.get('followMyLocation')) {\n        if ((typeof locationMarker !== 'undefined') && (getPointDistance(locationMarker.getPosition(), center) >= 5)) {\n          map.panTo(center)\n          locationMarker.setPosition(center)\n          Store.set('followMyLocationPosition', { lat: lat, lng: lng })\n        }\n      }\n    })\n  }\n}\n\nfunction createUpdateWorker () {\n  try {\n    if (isMobileDevice() && (window.Worker)) {\n      var updateBlob = new Blob([`onmessage = function(e) {\n        var data = e.data\n        if (data.name === 'backgroundUpdate') {\n          self.setInterval(function () {self.postMessage({name: 'backgroundUpdate'})}, 5000)\n        }\n      }`])\n\n      var updateBlobURL = window.URL.createObjectURL(updateBlob)\n\n      updateWorker = new Worker(updateBlobURL)\n\n      updateWorker.onmessage = function (e) {\n        var data = e.data\n        if (document.hidden && data.name === 'backgroundUpdate' && Date.now() - lastUpdateTime > 2500) {\n          updateMap()\n          updateGeoLocation()\n        }\n      }\n\n      updateWorker.postMessage({name: 'backgroundUpdate'})\n    }\n  } catch (ex) {\n    console.log('Webworker error: ' + ex.message)\n  }\n}\n\n//\n// Page Ready Exection\n//\n\n$(function () {\n  if (!Notification) {\n    console.log('could not load notifications')\n    return\n  }\n\n  if (Notification.permission !== 'granted') {\n    Notification.requestPermission()\n  }\n})\n\n$(function () {\n  // populate Navbar Style menu\n  $selectStyle = $('#map-style')\n\n  // Load Stylenames, translate entries, and populate lists\n  $.getJSON('static/dist/data/mapstyle.min.json').done(function (data) {\n    var styleList = []\n\n    $.each(data, function (key, value) {\n      styleList.push({\n        id: key,\n        text: i8ln(value)\n      })\n    })\n\n    // setup the stylelist\n    $selectStyle.select2({\n      placeholder: 'Select Style',\n      data: styleList,\n      minimumResultsForSearch: Infinity\n    })\n\n    // setup the list change behavior\n    $selectStyle.on('change', function (e) {\n      selectedStyle = $selectStyle.val()\n      map.setMapTypeId(selectedStyle)\n      Store.set('map_style', selectedStyle)\n    })\n\n    // recall saved mapstyle\n    $selectStyle.val(Store.get('map_style')).trigger('change')\n  })\n\n  $selectIconResolution = $('#pokemon-icons')\n\n  $selectIconResolution.select2({\n    placeholder: 'Select Icon Resolution',\n    minimumResultsForSearch: Infinity\n  })\n\n  $selectIconResolution.on('change', function () {\n    Store.set('pokemonIcons', this.value)\n    redrawPokemon(mapData.pokemons)\n    redrawPokemon(mapData.lurePokemons)\n  })\n\n  $selectIconSize = $('#pokemon-icon-size')\n\n  $selectIconSize.select2({\n    placeholder: 'Select Icon Size',\n    minimumResultsForSearch: Infinity\n  })\n\n  $selectIconSize.on('change', function () {\n    Store.set('iconSizeModifier', this.value)\n    redrawPokemon(mapData.pokemons)\n    redrawPokemon(mapData.lurePokemons)\n  })\n\n  $selectLuredPokestopsOnly = $('#lured-pokestops-only-switch')\n\n  $selectLuredPokestopsOnly.select2({\n    placeholder: 'Only Show Lured Pokestops',\n    minimumResultsForSearch: Infinity\n  })\n\n  $selectLuredPokestopsOnly.on('change', function () {\n    Store.set('showLuredPokestopsOnly', this.value)\n    lastpokestops = false\n    updateMap()\n  })\n\n  $selectSearchIconMarker = $('#iconmarker-style')\n  $selectLocationIconMarker = $('#locationmarker-style')\n\n  $.getJSON('static/dist/data/searchmarkerstyle.min.json').done(function (data) {\n    searchMarkerStyles = data\n    var searchMarkerStyleList = []\n\n    $.each(data, function (key, value) {\n      searchMarkerStyleList.push({\n        id: key,\n        text: value.name\n      })\n    })\n\n    $selectSearchIconMarker.select2({\n      placeholder: 'Select Icon Marker',\n      data: searchMarkerStyleList,\n      minimumResultsForSearch: Infinity\n    })\n\n    $selectSearchIconMarker.on('change', function (e) {\n      var selectSearchIconMarker = $selectSearchIconMarker.val()\n      Store.set('searchMarkerStyle', selectSearchIconMarker)\n      updateSearchMarker(selectSearchIconMarker)\n    })\n\n    $selectSearchIconMarker.val(Store.get('searchMarkerStyle')).trigger('change')\n\n    updateSearchMarker(Store.get('lockMarker'))\n\n    $selectLocationIconMarker.select2({\n      placeholder: 'Select Location Marker',\n      data: searchMarkerStyleList,\n      minimumResultsForSearch: Infinity\n    })\n\n    $selectLocationIconMarker.on('change', function (e) {\n      Store.set('locationMarkerStyle', this.value)\n      updateLocationMarker(this.value)\n    })\n\n    $selectLocationIconMarker.val(Store.get('locationMarkerStyle')).trigger('change')\n  })\n\n  $selectGymMarkerStyle = $('#gym-marker-style')\n\n  $selectGymMarkerStyle.select2({\n    placeholder: 'Select Style',\n    minimumResultsForSearch: Infinity\n  })\n\n  $selectGymMarkerStyle.on('change', function (e) {\n    Store.set('gymMarkerStyle', this.value)\n    updateGymIcons()\n  })\n\n  $selectGymMarkerStyle.val(Store.get('gymMarkerStyle')).trigger('change')\n})\n\n$(function () {\n  function formatState (state) {\n    if (!state.id) {\n      return state.text\n    }\n    var $state = $(\n      '<span><i class=\"pokemon-sprite n' + state.element.value.toString() + '\"></i> ' + state.text + '</span>'\n    )\n    return $state\n  }\n\n  if (Store.get('startAtUserLocation')) {\n    centerMapOnLocation()\n  }\n\n  $.getJSON('static/dist/data/moves.min.json').done(function (data) {\n    moves = data\n  })\n\n  $selectExclude = $('#exclude-pokemon')\n  $selectPokemonNotify = $('#notify-pokemon')\n  $selectRarityNotify = $('#notify-rarity')\n  $textPerfectionNotify = $('#notify-perfection')\n  var numberOfPokemon = 151\n\n  // Load pokemon names and populate lists\n  $.getJSON('static/dist/data/pokemon.min.json').done(function (data) {\n    var pokeList = []\n\n    $.each(data, function (key, value) {\n      if (key > numberOfPokemon) {\n        return false\n      }\n      var _types = []\n      pokeList.push({\n        id: key,\n        text: i8ln(value['name']) + ' - #' + key\n      })\n      value['name'] = i8ln(value['name'])\n      value['rarity'] = i8ln(value['rarity'])\n      $.each(value['types'], function (key, pokemonType) {\n        _types.push({\n          'type': i8ln(pokemonType['type']),\n          'color': pokemonType['color']\n        })\n      })\n      value['types'] = _types\n      idToPokemon[key] = value\n    })\n\n    // setup the filter lists\n    $selectExclude.select2({\n      placeholder: i8ln('Select Pokémon'),\n      data: pokeList,\n      templateResult: formatState\n    })\n    $selectPokemonNotify.select2({\n      placeholder: i8ln('Select Pokémon'),\n      data: pokeList,\n      templateResult: formatState\n    })\n    $selectRarityNotify.select2({\n      placeholder: i8ln('Select Rarity'),\n      data: [i8ln('Common'), i8ln('Uncommon'), i8ln('Rare'), i8ln('Very Rare'), i8ln('Ultra Rare')],\n      templateResult: formatState\n    })\n\n    // setup list change behavior now that we have the list to work from\n    $selectExclude.on('change', function (e) {\n      buffer = excludedPokemon\n      excludedPokemon = $selectExclude.val().map(Number)\n      buffer = buffer.filter(function (e) { return this.indexOf(e) < 0 }, excludedPokemon)\n      reincludedPokemon = reincludedPokemon.concat(buffer)\n      clearStaleMarkers()\n      Store.set('remember_select_exclude', excludedPokemon)\n    })\n    $selectPokemonNotify.on('change', function (e) {\n      notifiedPokemon = $selectPokemonNotify.val().map(Number)\n      Store.set('remember_select_notify', notifiedPokemon)\n    })\n    $selectRarityNotify.on('change', function (e) {\n      notifiedRarity = $selectRarityNotify.val().map(String)\n      Store.set('remember_select_rarity_notify', notifiedRarity)\n    })\n    $textPerfectionNotify.on('change', function (e) {\n      notifiedMinPerfection = parseInt($textPerfectionNotify.val(), 10)\n      if (isNaN(notifiedMinPerfection) || notifiedMinPerfection <= 0) {\n        notifiedMinPerfection = ''\n      }\n      if (notifiedMinPerfection > 100) {\n        notifiedMinPerfection = 100\n      }\n      $textPerfectionNotify.val(notifiedMinPerfection)\n      Store.set('remember_text_perfection_notify', notifiedMinPerfection)\n    })\n\n    // recall saved lists\n    $selectExclude.val(Store.get('remember_select_exclude')).trigger('change')\n    $selectPokemonNotify.val(Store.get('remember_select_notify')).trigger('change')\n    $selectRarityNotify.val(Store.get('remember_select_rarity_notify')).trigger('change')\n    $textPerfectionNotify.val(Store.get('remember_text_perfection_notify')).trigger('change')\n\n    if (isTouchDevice() && isMobileDevice()) {\n      $('.select2-search input').prop('readonly', true)\n    }\n  })\n\n  // run interval timers to regularly update map and timediffs\n  window.setInterval(updateLabelDiffTime, 1000)\n  window.setInterval(updateMap, 5000)\n  window.setInterval(updateGeoLocation, 1000)\n\n  createUpdateWorker()\n\n  // Wipe off/restore map icons when switches are toggled\n  function buildSwitchChangeListener (data, dataType, storageKey) {\n    return function () {\n      Store.set(storageKey, this.checked)\n      if (this.checked) {\n        // When switch is turned on we asume it has been off, makes sure we dont end up in limbo\n        // Without this there could've been a situation where no markers are on map and only newly modified ones are loaded\n        if (storageKey === 'showPokemon') {\n          lastpokemon = false\n        } else if (storageKey === 'showGyms') {\n          lastgyms = false\n        } else if (storageKey === 'showPokestops') {\n          lastpokestops = false\n        } else if (storageKey === 'showScanned') {\n          lastslocs = false\n        } else if (storageKey === 'showSpawnpoints') {\n          lastspawns = false\n        }\n\n        updateMap()\n      } else {\n        $.each(dataType, function (d, dType) {\n          $.each(data[dType], function (key, value) {\n            // for any marker you're turning off, you'll want to wipe off the range\n            if (data[dType][key].marker.rangeCircle) {\n              data[dType][key].marker.rangeCircle.setMap(null)\n              delete data[dType][key].marker.rangeCircle\n            }\n            if (storageKey !== 'showRanges') data[dType][key].marker.setMap(null)\n          })\n          if (storageKey !== 'showRanges') data[dType] = {}\n        })\n        if (storageKey === 'showRanges') {\n          updateMap()\n        }\n      }\n    }\n  }\n\n  // Setup UI element interactions\n  $('#gyms-switch').change(function () {\n    buildSwitchChangeListener(mapData, ['gyms'], 'showGyms').bind(this)()\n  })\n  $('#pokemon-switch').change(function () {\n    buildSwitchChangeListener(mapData, ['pokemons'], 'showPokemon').bind(this)()\n  })\n  $('#scanned-switch').change(function () {\n    buildSwitchChangeListener(mapData, ['scanned'], 'showScanned').bind(this)()\n  })\n  $('#spawnpoints-switch').change(function () {\n    buildSwitchChangeListener(mapData, ['spawnpoints'], 'showSpawnpoints').bind(this)()\n  })\n  $('#ranges-switch').change(buildSwitchChangeListener(mapData, ['gyms', 'pokemons', 'pokestops'], 'showRanges'))\n\n  $('#pokestops-switch').change(function () {\n    var options = {\n      'duration': 500\n    }\n    var wrapper = $('#lured-pokestops-only-wrapper')\n    if (this.checked) {\n      lastpokestops = false\n      wrapper.show(options)\n    } else {\n      lastpokestops = false\n      wrapper.hide(options)\n    }\n    return buildSwitchChangeListener(mapData, ['pokestops'], 'showPokestops').bind(this)()\n  })\n\n  $('#sound-switch').change(function () {\n    Store.set('playSound', this.checked)\n  })\n\n  $('#geoloc-switch').change(function () {\n    $('#next-location').prop('disabled', this.checked)\n    $('#next-location').css('background-color', this.checked ? '#e0e0e0' : '#ffffff')\n    if (!navigator.geolocation) {\n      this.checked = false\n    } else {\n      Store.set('geoLocate', this.checked)\n    }\n  })\n\n  $('#lock-marker-switch').change(function () {\n    Store.set('lockMarker', this.checked)\n    searchMarker.setDraggable(!this.checked)\n  })\n\n  $('#search-switch').change(function () {\n    searchControl(this.checked ? 'on' : 'off')\n  })\n\n  $('#start-at-user-location-switch').change(function () {\n    Store.set('startAtUserLocation', this.checked)\n  })\n\n  $('#follow-my-location-switch').change(function () {\n    if (!navigator.geolocation) {\n      this.checked = false\n    } else {\n      Store.set('followMyLocation', this.checked)\n    }\n    locationMarker.setDraggable(!this.checked)\n  })\n\n  $('#scan-here-switch').change(function () {\n    if (this.checked && !Store.get('scanHereAlerted')) {\n      alert('Use this feature carefully ! This button will set the current map center as new search location. This may cause worker to teleport long range.')\n      Store.set('scanHereAlerted', true)\n    }\n    $('#scan-here').toggle(this.checked)\n    Store.set('scanHere', this.checked)\n  })\n\n  if ($('#nav-accordion').length) {\n    $('#nav-accordion').accordion({\n      active: 0,\n      collapsible: true,\n      heightStyle: 'content'\n    })\n  }\n\n  // Initialize dataTable in statistics sidebar\n  //   - turn off sorting for the 'icon' column\n  //   - initially sort 'name' column alphabetically\n\n  $('#pokemonList_table').DataTable({\n    paging: false,\n    searching: false,\n    info: false,\n    errMode: 'throw',\n    'language': {\n      'emptyTable': ''\n    },\n    'columns': [\n      { 'orderable': false },\n      null,\n      null,\n      null\n    ]\n  }).order([1, 'asc'])\n})\n"]}